{% extends 'base.html' %}

{% block title %}参与投票{% endblock %}

{% block content %}
    <div class="vote-container">
        <h2>{{ poll.question }}</h2>
        
        <form method="post" class="vote-form" id="voteForm">
            <input type="hidden" name="fingerprint" id="fingerprintInput">
            {% for option in options %}
            <div class="option-radio">
                <input type="radio" 
                       id="option{{ option.id }}" 
                       name="option" 
                       value="{{ option.id }}" 
                       required>
                <label for="option{{ option.id }}" class="radio-label">
                    {{ option.option_text }}
                </label>
            </div>
            {% endfor %}
            
            <div class="form-actions">
                <button type="submit" class="button">提交投票</button>
                <a href="{{ url_for('results', poll_id=poll.id) }}" class="button secondary">查看结果</a>
            </div>
        </form>
    </div>

    <style>
        .radio-label {
            display: block;
            padding: 10px 15px;
            margin: 5px 0;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .option-radio input[type="radio"] {
            display: none;
        }

        .option-radio input[type="radio"]:checked + .radio-label {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .radio-label:hover {
            background-color: var(--background-color);
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('voteForm');
            const fingerprintInput = document.getElementById('fingerprintInput');

            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                try {
                    // 获取浏览器指纹
                    const fingerprint = await getBrowserFingerprint();
                    if (!fingerprint) {
                        alert('无法获取浏览器指纹，请确保启用了JavaScript并允许相关权限。');
                        return;
                    }
                    
                    // 设置指纹到隐藏字段
                    fingerprintInput.value = fingerprint;
                    
                    // 提交表单
                    form.submit();
                } catch (error) {
                    console.error('获取浏览器指纹时出错:', error);
                    alert('提交失败，请稍后重试。');
                }
            });
        });
    </script>
{% endblock %}